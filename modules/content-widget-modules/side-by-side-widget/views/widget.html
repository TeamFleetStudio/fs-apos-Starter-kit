{% set bgColor = data.widget.bgColor | default("") %}
{% set bgImg = "" %}
{% set bgImgColOne = "" %}
{% set bgImgColTwo = "" %}

{% if data.widget.bgType === "bgImg" %}
  {% if data.widget.bgImgType === "bgCover" and data.widget.bgImg and apos.image.first(data.widget.bgImg) and apos.image.first(data.widget.bgImg)._urls.original %}
    {% set bgImg = apos.image.first(data.widget.bgImg)._urls.original %}
  {% elif data.widget.bgImgType === "bgIndividual" %}
    {% if data.widget.firstColumnImg and apos.image.first(data.widget.firstColumnImg) and apos.image.first(data.widget.firstColumnImg)._urls.original %}
      {% set bgImgColOne = apos.image.first(data.widget.firstColumnImg)._urls.original %}
    {% endif %}
    {% if  data.widget.secondColumnImg and apos.image.first(data.widget.secondColumnImg) and apos.image.first(data.widget.secondColumnImg)._urls.original%}
      {% set bgImgColTwo = apos.image.first(data.widget.secondColumnImg)._urls.original %}
    {% endif %}
  {% endif %}
{% else %}
  {% set bgImg = "" %}
  {% set bgImgColOne = "" %}
  {% set bgImgColTwo = "" %}
{% endif %}

{# AGGRESSIVE LCP optimization for mobile - apply to ALL background images #}
{% if bgImg %}
  <link rel="preload" as="image" href="{{ bgImg }}" fetchpriority="high">
{% endif %}
{% if bgImgColOne %}
  <link rel="preload" as="image" href="{{ bgImgColOne }}" fetchpriority="high">
{% endif %}
{% if bgImgColTwo %}
  <link rel="preload" as="image" href="{{ bgImgColTwo }}" fetchpriority="high">
{% endif %}

<section data-aos="{{ data.widget.animationEffects }}" class="{{ 'is-fluid' if data.widget.style === 'full' else 'mx-8 lg:mx-16' }} side-by-side {{ data.widget.widgetClass }} flex flex-col md:flex-row"
style="
    {{ "background-color: " + bgColor + "" if bgColor }}
    {% if bgImg %}
      background-image: url('{{ bgImg }}');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    {% endif %}
  " 
  {% if data.widget.widgetId %}
    id="{{ data.widget.widgetId }}"
  {% endif %}
>
  {# AGGRESSIVE hidden img elements for mobile LCP optimization #}
  {% if bgImg %}
    <img src="{{ bgImg }}" alt="" style="position: absolute; width: 1px; height: 1px; opacity: 0; pointer-events: none;" fetchpriority="high" loading="eager">
  {% endif %}
  {% if bgImgColOne %}
    <img src="{{ bgImgColOne }}" alt="" style="position: absolute; width: 1px; height: 1px; opacity: 0; pointer-events: none;" fetchpriority="high" loading="eager">
  {% endif %}
  {% if bgImgColTwo %}
    <img src="{{ bgImgColTwo }}" alt="" style="position: absolute; width: 1px; height: 1px; opacity: 0; pointer-events: none;" fetchpriority="high" loading="eager">
  {% endif %}
  <div class="side-by-side__column-item column-item__first {{ 'invert' if data.widget.invert === true}}" style="
    {{ "background-image: url('" + bgImgColOne + "');" if bgImgColOne }}
  ">
    {% area data.widget, 'one' with data.contextOptions %}
  </div>
  <div class="side-by-side__column-item column-item__second" style="
    {{ "background-image: url('" + bgImgColTwo + "');" if bgImgColTwo }}
  ">
    {% area data.widget, 'two' with data.contextOptions %}
  </div>
</section>